<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HSK Exercise Platform</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      background: #f8f9fa;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      min-height: 100vh;
    }

    .header {
      background: #ff6b6b;
      color: white;
      padding: 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .level-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .level-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .level-btn:hover, .level-btn.active {
      background: white;
      color: #ff6b6b;
    }

    .lesson-selector {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }

    .lesson-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .lesson-btn:hover, .lesson-btn.active {
      background: white;
      color: #ff6b6b;
    }

    .lesson-btn.has-content {
      border: 2px solid #90EE90;
      background: rgba(144, 238, 144, 0.2);
    }

    .lesson-btn.has-content.active {
      background: #90EE90;
      color: #ff6b6b;
    }

    .content {
      padding: 30px;
    }

    .lesson-info {
      background: #e8f4fd;
      border: 1px solid #4dabf7;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }

    .lesson-info h2 {
      color: #4dabf7;
      margin-bottom: 5px;
    }

    .notes-section {
      background: #fff5f5;
      border: 1px solid #ff6b6b;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .notes-title {
      color: #ff6b6b;
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .notes-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .note-box h4 {
      color: #ff6b6b;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .note-textarea {
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
      font-size: 0.9rem;
    }

    .note-textarea:focus {
      outline: none;
      border-color: #ff6b6b;
    }

    .exercises {
      max-width: 100%;
    }

    .question {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .question:last-child {
      border-bottom: none;
    }

    .question-number {
      color: #ff6b6b;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .question-text {
      margin-bottom: 10px;
      font-size: 1.05rem;
      line-height: 1.7;
    }

    .answer-input, .answer-select {
      width: 100%;
      max-width: 300px;
      padding: 8px 12px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .answer-input:focus, .answer-select:focus {
      outline: none;
      border-color: #ff6b6b;
    }

    .sentence-parts {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .sentence-parts h4 {
      margin-bottom: 10px;
      color: #666;
      font-size: 0.9rem;
    }

    .parts-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .part-item {
      background: #e9ecef;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 0.9rem;
    }

    .reading-passage {
      background: #f8f9fa;
      padding: 15px;
      border-left: 3px solid #ff6b6b;
      margin-bottom: 15px;
      font-size: 1rem;
      line-height: 1.7;
    }

    .save-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      display: block;
      margin: 30px auto 0;
    }

    .save-btn:hover {
      background: #e55555;
    }

    .placeholder-content {
      text-align: center;
      padding: 50px;
      color: #666;
      background: #f8f9fa;
      border-radius: 8px;
      margin: 20px 0;
    }

    .add-content-guide {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .add-content-guide h4 {
      color: #856404;
      margin-bottom: 10px;
    }

    .add-content-guide pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      .content {
        padding: 20px;
      }

      .notes-grid {
        grid-template-columns: 1fr;
      }

      .lesson-selector {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>HSK Exercise Platform</h1>
      
      <div class="level-selector">
        <button class="level-btn active" onclick="selectLevel('HSK4')">HSK 4</button>
        <button class="level-btn" onclick="selectLevel('HSK5')">HSK 5</button>
      </div>

      <div class="lesson-selector" id="lesson-selector">
        <!-- Lesson buttons will be generated dynamically -->
      </div>
    </div>

    <div class="content">
      <div class="lesson-info" id="lesson-info">
        <h2 id="lesson-title">HSK 4 - Lesson 1</h2>
        <div id="lesson-status">Content not added yet</div>
      </div>

      <div class="notes-section">
        <div class="notes-title">📝 Lesson Notes</div>
        <div class="notes-grid">
          <div class="note-box">
            <h4>New Vocabulary</h4>
            <textarea class="note-textarea" id="vocabulary-notes" placeholder="Write down new words..."></textarea>
          </div>
          <div class="note-box">
            <h4>Grammar Points</h4>
            <textarea class="note-textarea" id="grammar-notes" placeholder="Note grammar patterns..."></textarea>
          </div>
        </div>
      </div>

      <div class="exercises" id="lesson-content">
        <!-- Lesson content will be loaded here -->
      </div>

      <button class="save-btn" onclick="downloadAnswers()">Download Answers</button>
    </div>
  </div>

  <script>
    // Enhanced lesson data structure with content and question mapping
    const lessonData = {
      HSK4: {
        1: { title: "Lesson 1 - Basic Conversations", questionRange: [1, 10] },
        2: { title: "Lesson 2 - Daily Activities", questionRange: [11, 20] },
        3: { title: "Lesson 3 - Food & Dining", questionRange: [21, 30] },
        4: { title: "Lesson 4 - Transportation", questionRange: [31, 40] },
        5: { title: "Lesson 5 - Shopping", questionRange: [23, 48] },
        6: { title: "Lesson 6 - Health & Exercise", questionRange: [49, 58] },
        7: { title: "Lesson 7 - Weather & Seasons", questionRange: [59, 68] },
        8: { title: "Lesson 8 - Education", questionRange: [69, 78] },
        9: { title: "Lesson 9 - Work & Career", questionRange: [79, 88] },
        10: { title: "Lesson 10 - Family & Relationships", questionRange: [89, 98] },
        11: { title: "Lesson 11 - Hobbies & Sports", questionRange: [99, 108] },
        12: { title: "Lesson 12 - Technology", questionRange: [109, 118] },
        13: { title: "Lesson 13 - Travel & Tourism", questionRange: [119, 128] },
        14: { title: "Lesson 14 - Culture & Traditions", questionRange: [129, 138] },
        15: { title: "Lesson 15 - Environment", questionRange: [139, 148] },
        16: { title: "Lesson 16 - Economy & Business", questionRange: [149, 158] },
        17: { title: "Lesson 17 - Entertainment", questionRange: [159, 168] },
        18: { title: "Lesson 18 - Science & Innovation", questionRange: [169, 178] },
        19: { title: "Lesson 19 - Social Issues", questionRange: [179, 188] },
        20: { title: "Lesson 20 - Review & Assessment", questionRange: [189, 200] }
      },
      HSK5: {
        1: { title: "Lesson 1 - Advanced Conversations", questionRange: [1, 15] },
        2: { title: "Lesson 2 - Complex Grammar", questionRange: [16, 30] },
        // Add more HSK5 lessons as needed...
      }
    };

    // Function to automatically detect if a lesson has content
    function hasLessonContent(level, lessonNum) {
      const lessonKey = `lesson${lessonNum}`;
      return questionDatabase.hasOwnProperty(lessonKey) && Object.keys(questionDatabase[lessonKey]).length > 0;
    }

    // Current state
    let currentLevel = 'HSK4';
    let currentLesson = 5; // Start with lesson 5 which has content

    // Question data for different lessons
    const questionDatabase = {
      // Lesson 5 questions (23-48)
      lesson5: {
        23: { text: "现在坐电梯的人（ ）很多，咖啡馆就在二层，我们走上去吧。", type: "select", options: ["A - 效果", "B - 打折", "C - 顺便", "D - 坚持", "E - 肯定"] },
        24: { text: "那件衣服（ ）后只要80元，很便宜。", type: "select", options: ["A - 效果", "B - 打折", "C - 顺便", "D - 坚持", "E - 肯定"] },
        25: { text: "你去买啤酒吗？（ ）帮我买一盒牛奶吧。", type: "select", options: ["A - 效果", "B - 打折", "C - 顺便", "D - 坚持", "E - 肯定"] },
        26: { text: "这张山水画放在房间里（ ）肯定不错，就买它了。", type: "select", options: ["A - 效果", "B - 打折", "C - 顺便", "D - 坚持", "E - 肯定"] },
        27: { text: "A: 爷爷，您换洗衣机了？ B: 不光是洗衣机，你去房间里看看，我把（ ）也换了。", type: "select", options: ["A - 样子", "B - 浪费", "C - 温度", "D - 质量", "E - 家具"] },
        28: { text: "A: 还有这么多菜没吃完，太（ ）了。 B: 那把服务员叫来，我们都带回去吧。", type: "select", options: ["A - 样子", "B - 浪费", "C - 温度", "D - 质量", "E - 家具"] },
        29: { text: "A: 看（ ）你对这里很熟悉。 B: 当然了，我在这儿住了差不多十年，去年才搬走的。", type: "select", options: ["A - 样子", "B - 浪费", "C - 温度", "D - 质量", "E - 家具"] },
        30: { text: "A: 你这双鞋在哪儿买的？看上去（ ）不错。 B: 我也不知道，我爱人给我买的。", type: "select", options: ["A - 样子", "B - 浪费", "C - 温度", "D - 质量", "E - 家具"] },
        31: { text: "Arrange in correct order: A 另外，价格还便宜 B 现在网上购物很流行 C 你在网上买的东西会送到你办公室或者家里", type: "input" },
        32: { text: "Arrange in correct order: A 这儿离地铁站很近，附近也有很多公共汽车站 B 但房价可不便宜 C 所以，别看房子有点儿旧", type: "input" },
        33: { text: "Arrange in correct order: A 但我还是一眼就认出了他 B 虽然毕业以后我们存了20多年没见面了 C 因为他的样子儿子没什么变化", type: "input" },
        34: { text: "Arrange in correct order: A 我打算送她一个 B 妹妹很早之前就想买个照相机 C 下个月一号正好她过生日", type: "input" },
        35: { text: "Reading passage: 现在在网上几乎什么都可以买到，你可以在网上买书、买鞋、买水果，你还可以在网上买沙发、买缝纫、大多数网上商店可以保证东西的质量。\nQuestion: 这段话主要介绍什么？", type: "select", options: ["A - 怎么上网", "B - 网上购物", "C - 电子邮件", "D - 怎么做生意"] },
        36: { text: "Reading passage: 说话虽然是生活中很普通的事，却不简单，有很多地方要注意：别人的事，要小心地说；讨厌的事，要对事不对人地说；现在的事，做了再说；以后的事，以后再说；而不能肯定的事不要说。\nQuestion: 根据这段话，不能肯定的事：", type: "select", options: ["A - 和同事说", "B - 多和朋友说", "C - 要让邻居知道", "D - 别说"] },
        37: { text: "Reading passage: 人们很容易被便宜的东西吸引，尤其在商家打折的时候，常常会买一些自己来不需要、很可能一直都用不到的东西。\nQuestion: 人们为什么会买一些不需要的东西？", type: "select", options: ["A - 质量好", "B - 漂亮", "C - 便宜", "D - 不打折"] },
        38: { text: "Reading passage: 有些人喜欢根据别人的喜好来选购衣服，认为流行的就是好的，但实际上，真正适合自己的才是最好的。\nQuestion: 这段话告诉我们应该选什么样的衣服？", type: "select", options: ["A - 适合自己的", "B - 样子流行的", "C - 大家都满意的", "D - 质量好的"] },
        39: { text: "Reading passage: 了解顾客的实际需要十分重要，一样东西，不管它质量多好，多便宜，如果顾客完全不需要它，我们就很难把它卖出去。\nQuestion: 除了质量和价格，顾客还会考虑：", type: "select", options: ["A - 商场的服务", "B - 自己需要不需要", "C - 自己的购买能力", "D - 商场的环境"] },
        40: { text: "Reading passage: 在节假日，我们经常会看到商场举办各种打折活动，这样做主要是为了吸引更多的顾客来购物。不过人们在购买的时候，不能只看价格，还应考虑买的东西是不是适合自己，是不是必须买。如果不适合自己，不是必须买，即使便宜很多也是一种浪费。\nQuestion: 节假日商场打折是为了：", type: "select", options: ["A - 吸引顾客", "B - 保证质量", "C - 丰富人们的生活", "D - 提高服务的水平"] },
        41: { text: "Question based on passage above: 根据这段话，买东西应该考虑：", type: "select", options: ["A - 质量好坏", "B - 家人是否同意", "C - 有没有用", "D - 自己的收入"] },
        42: { text: "Reading passage: 买衣服只考虑便宜当然不好，但是只买贵的也不一定对。我对衣服的要求：第一是要自己穿着舒服，第二是衣服的质量要好，而且又不能太贵。衣服的样子流行不流行，对我来说并不是很重要。很多年轻人买衣服只喜欢逛大商场，只买贵衣服，而对那些衣服是不是适合自己却不会考虑很多。这一点是我理解不了的。\nQuestion: 她认为，买衣服：", type: "select", options: ["A - 应该多调查", "B - 舒服最重要", "C - 要买打折的", "D - 样子要流行"] },
        43: { text: "Question based on passage above: 根据这段话，可以知道什么？", type: "select", options: ["A - 便宜没好货", "B - 约会别迟到", "C - 要互相理解", "D - 适合最重要"] },
        44: { text: "Arrange these words into a complete sentence: 不错 这台 质量 洗衣机 的", type: "input" },
        45: { text: "Arrange these words into a complete sentence: 不会 肯定 他 同意你这么做", type: "input" },
        46: { text: "Arrange these words into a complete sentence: 流行的 音乐 这是现在 最", type: "input" },
        47: { text: "Arrange these words into a complete sentence: 不得不 他 重新 考虑这件事", type: "input" },
        48: { text: "Arrange these words into a complete sentence: 普通话 不太 我的 说得 标准", type: "input" }
      },
      // Lesson 6 questions (49-58)
      lesson6: {
  23: {     text: "你应该学会说"不"，而不是（ ）的要求都接受。",     type: "select",     options: ["A - 情况", "B - 获得", "C - 举办", "D - 坚持", "E - 所有"]   },
  24: {     text: "没想到她第一次参加比赛就（ ）了这么大的成功。",     type: "select",     options: ["A - 情况", "B - 获得", "C - 举办", "D - 坚持", "E - 所有"]   },
  25: {     text: "您说的这个（ ）很重要，我们今天就安排人去调查。",     type: "select",     options: ["A - 情况", "B - 获得", "C - 举办", "D - 坚持", "E - 所有"]   },
  26: {     text: "我们学校经常会（ ）一些活动来丰富学生们的生活。",     type: "select",     options: ["A - 情况", "B - 获得", "C - 举办", "D - 坚持", "E - 所有"]   },
  27: {     text: "A: 哼，你的这个行李箱（ ）跟我的完全一样。\nB: 那是我去年夏天买的，你是什么时候买的？",     type: "select",     options: ["A - 支持", "B - 方面", "C - 温度", "D - 竟然", "E - 小说"]   },
  28: {     text: "A: 这本（ ）很有意思，我差不多明天就能看完，后天见面时就可以还你。\nB: 不着急，你慢慢看，周末给我吧。",     type: "select",     options: ["A - 支持", "B - 方面", "C - 温度", "D - 竟然", "E - 小说"]   },
  29: {     text: "A: 王教授，感谢您对我们工作的（ ）。\nB: 别客气，这是我应该做的。",     type: "select",     options: ["A - 支持", "B - 方面", "C - 温度", "D - 竟然", "E - 小说"]   },
  30: {     text: "A: 你有没有李律师的电话？我想问他几个法律（ ）的问题。\nB: 有，我发到你手机上，你直接跟他联系就可以。",     type: "select",     options: ["A - 支持", "B - 方面", "C - 温度", "D - 竟然", "E - 小说"]   },
  31: {     text: "Arrange in correct order: A 现在只卖300块 B 原价是现在的两倍多呢，我找一件您试试吧 C 这种裙子今年非常流行，质量很好",     type: "input"   },
  32: {     text: "Arrange in correct order: A 他是我大学时的同学 B 毕业后我们就再也没联系过 C 没想到中午我去取护照时竟然遇到他了",     type: "input"   },
  33: {     text: "Arrange in correct order: A 但是他很诚实 B 小关的脾气有时候是有点儿差 C 是个值得相信的人",     type: "input"   },
  34: {     text: "Arrange in correct order: A 这种情况下，就需要及时交流 B 两个人在一起，总会遇到问题 C 如果不这样的话，关系就可能会越来越远",     type: "input"   },
  35: {     text: "Reading passage: 实际上，售货员太热情地为顾客介绍、介绍邮、会让我觉得很不舒服。许多人在逛商场时喜欢自己看、自己选，而不愿意总是被别人打扰。\nQuestion: "我"在逛商场时：",     type: "select",     options: ["A - 觉得无聊", "B - 喜欢自己选", "C - 很少考虑价格", "D - 喜欢售货员介绍"]   },
  36: {     text: "Reading passage: 做生意讲的是"一分钱一分货"，意思是说货物的质量和价格有很大的关系，所以人们经常说"便宜没好货，好货不便宜"。\nQuestion: 一般情况下，贵的东西：",     type: "select",     options: ["A - 广告多", "B - 哪得多", "C - 不好卖", "D - 质量好"]   },
  37: {     text: "Reading passage: 每到换季或者节假日的时候，各大商场都会举办一些打折活动来吸引顾客。这样人们就能花比较少的钱买到质量不错的东西，有时一样的东西甚至能比平时少花一半的钱。\nQuestion: 商场举办活动是为了：",     type: "select",     options: ["A - 检查质量", "B - 吸引顾客", "C - 举行招聘会", "D - 提高服务水平"]   },
  38: {     text: "Reading passage: 如果一个星期内发现有任何质量问题，我们都可以免费为您换，但是购物小票一定要留好。如果没有购物小票，我们是没法给您换的。\nQuestion: 说话人提醒他：",     type: "select",     options: ["A - 看购物小票", "B - 留着购物小票", "C - 一个月以内换", "D - 东西不能换"]   },
  39: {     text: "Reading passage: 小娟，这些菜是绿色食品，不仅很好吃，而且对身体也很有好处，所以价格要比其他菜贵一些。\nQuestion: 这些菜的特点是：",     type: "select",     options: ["A - 干净", "B - 便宜", "C - 味道不太好", "D - 对身体好"]   },
  40: {     text: "Reading passage: 顾客朋友们，本超市现举行"购物送好礼"活动，购物满100元即可获得可乐一瓶，满500元可获得葡萄酒一瓶。另外，还有水果打折活动，其中，苹果9折，葡萄8折，香蕉、西瓜6折。欢迎选购！祝您购物愉快！\nQuestion: 购物满100元能获得什么礼物？",     type: "select",     options: ["A - 西红柿", "B - 葡萄酒", "C - 可乐", "D - 西瓜"]   },
  41: {     text: "Reading passage: 顾客朋友们，本超市现举行"购物送好礼"活动，购物满100元即可获得可乐一瓶，满500元可获得葡萄酒一瓶。另外，还有水果打折活动，其中，苹果9折，葡萄8折，香蕉、西瓜6折。欢迎选购！祝您购物愉快！\nQuestion: 根据这段话，可以知道：",     type: "select",     options: ["A - 超市生意很好", "B - 葡萄酒半价", "C - 有些水果打折", "D - 饮料免费"]   },
  42: {     text: "Reading passage: 你卖的东西可不可以比别人卖的价格高？这主要要看东西的质量。如果质量比别人的好，那么价格比别人的贵一点儿也没关系。另外，环境和服务水平也很重要。质量完全一样的东西，但如果环境和服务更好，那么即使贵一点儿，大家也能接受。\nQuestion: 这段话主要想说明，质量好的东西可以：",     type: "select",     options: ["A - 卖得贵", "B - 卖得快", "C - 用得久", "D - 很流行"]   },
  43: {     text: "Reading passage: 你卖的东西可不可以比别人卖的价格高？这主要要看东西的质量。如果质量比别人的好，那么价格比别人的贵一点儿也没关系。另外，环境和服务水平也很重要。质量完全一样的东西，但如果环境和服务更好，那么即使贵一点儿，大家也能接受。\nQuestion: 质量相同的东西，怎样能卖更高的价格？",     type: "select",     options: ["A - 做广告", "B - 送礼物", "C - 免费试用", "D - 提高服务水平"]   },
  44: {     text: "Arrange these words into a complete sentence: 这双筷子 给我的 是 弟弟",     type: "input"   },
  45: {     text: "Arrange these words into a complete sentence: 水 瓶子 的 满了 里",     type: "input"   },
  46: {     text: "Arrange these words into a complete sentence: 饮料 火车上 不提供 免费的",     type: "input"   },
  47: {     text: "Arrange these words into a complete sentence: 举行 这次电影艺术节 北京 会 在",     type: "input"   },
  48: {     text: "Arrange these words into a complete sentence: 对 非常感谢您 理解和支持 我们工作的",     type: "input"   }

      }
    };

    // Initialize the platform
    function initializePlatform() {
      generateLessonButtons();
      selectLesson(currentLesson);
    }

    // Generate lesson buttons dynamically
    function generateLessonButtons() {
      const selector = document.getElementById('lesson-selector');
      const lessons = lessonData[currentLevel];
      
      selector.innerHTML = '';
      
      for (let i = 1; i <= Object.keys(lessons).length; i++) {
        const lesson = lessons[i];
        const hasContent = hasLessonContent(currentLevel, i);
        const button = document.createElement('button');
        button.className = `lesson-btn ${hasContent ? 'has-content' : ''} ${i === currentLesson ? 'active' : ''}`;
        button.textContent = `Lesson ${i}`;
        button.onclick = () => selectLesson(i);
        selector.appendChild(button);
      }
    }

    function selectLevel(level) {
      currentLevel = level;
      currentLesson = 1; // Reset to lesson 1 when switching levels
      
      // Update active button
      document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Regenerate lesson buttons and load content
      generateLessonButtons();
      selectLesson(1);
    }

    function selectLesson(lessonNum) {
      currentLesson = lessonNum;
      
      // Update active button
      document.querySelectorAll('.lesson-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.lesson-btn')[lessonNum - 1].classList.add('active');
      
      // Clear notes for new lesson
      clearNotes();
      
      // Load lesson content
      loadLessonContent(currentLevel, lessonNum);
      
      // Update lesson info
      updateLessonInfo(lessonNum);
    }

    function updateLessonInfo(lessonNum) {
      const lesson = lessonData[currentLevel][lessonNum];
      const hasContent = hasLessonContent(currentLevel, lessonNum);
      document.getElementById('lesson-title').textContent = `${currentLevel} - ${lesson.title}`;
      document.getElementById('lesson-status').textContent = hasContent ? 
        `✅ Content available (Questions ${lesson.questionRange[0]}-${lesson.questionRange[1]})` : 
        '⚠️ Content not added yet';
    }

    function clearNotes() {
      document.getElementById('vocabulary-notes').value = '';
      document.getElementById('grammar-notes').value = '';
    }

    function loadLessonContent(level, lessonNum) {
      const contentContainer = document.getElementById('lesson-content');
      const lesson = lessonData[level][lessonNum];
      const hasContent = hasLessonContent(level, lessonNum);
      
      if (!hasContent) {
        // Show placeholder with instructions
        contentContainer.innerHTML = getPlaceholderContent(lessonNum);
        return;
      }
      
      // Automatically generate content from questionDatabase
      contentContainer.innerHTML = generateLessonContent(lessonNum);
    }

    // Universal content generator - works for any lesson automatically!
    function generateLessonContent(lessonNum) {
      const lessonKey = `lesson${lessonNum}`;
      const questions = questionDatabase[lessonKey];
      
      if (!questions) return '';
      
      let html = '';
      const questionNumbers = Object.keys(questions).map(Number).sort((a, b) => a - b);
      
      for (let qNum of questionNumbers) {
        const q = questions[qNum];
        if (!q) continue;
        
        html += `<div class="question">
          <div class="question-number">${qNum}.</div>`;
        
        // Handle different question formats automatically
        if (q.text.includes('Reading passage:')) {
          const parts = q.text.split('\nQuestion: ');
          const passage = parts[0].replace('Reading passage: ', '');
          const question = parts[1];
          
          html += `<div class="reading-passage">${passage}</div>
            <div class="question-text">${question}</div>`;
        } else if (q.text.includes('Arrange')) {
          if (q.text.includes('correct order:')) {
            const orderText = q.text.split('correct order: ')[1];
            html += `<div class="sentence-parts">
              <h4>Arrange in correct order:</h4>
              <div class="parts-list">`;
            
            // Parse the parts - look for pattern "A something B something C something"
            const matches = orderText.match(/([A-Z])\s+([^A-Z]+?)(?=\s+[A-Z]|$)/g);
            if (matches) {
              for (let match of matches) {
                html += `<span class="part-item">${match.trim()}</span>`;
              }
            } else {
              // Fallback: split by spaces and group
              const parts = orderText.split(' ');
              let currentPart = '';
              for (let i = 0; i < parts.length; i++) {
                if (parts[i].match(/^[A-Z]$/) && currentPart) {
                  html += `<span class="part-item">${currentPart.trim()}</span>`;
                  currentPart = parts[i] + ' ';
                } else {
                  currentPart += parts[i] + ' ';
                }
              }
              if (currentPart) {
                html += `<span class="part-item">${currentPart.trim()}</span>`;
              }
            }
            html += `</div></div>`;
          } else if (q.text.includes('complete sentence:')) {
            const words = q.text.replace(/.*complete sentence:\s*/, '').split(' ');
            html += `<div class="sentence-parts">
              <h4>Arrange these words into a complete sentence:</h4>
              <div class="parts-list">`;
            for (let word of words) {
              if (word.trim()) html += `<span class="part-item">${word.trim()}</span>`;
            }
            html += `</div></div>`;
          }
        } else {
          html += `<div class="question-text">${q.text}</div>`;
        }
        
        // Generate input fields automatically
        if (q.type === 'select' && q.options) {
          html += `<select class="answer-select" id="q${qNum}">
            <option value="">Choose an option...</option>`;
          for (let option of q.options) {
            const value = option.includes(' - ') ? option.split(' - ')[0] : option;
            html += `<option value="${value}">${option}</option>`;
          }
          html += `</select>`;
        } else if (q.type === 'input') {
          const placeholder = q.text.includes('correct order') ? 
            'Enter order (e.g., A-B-C)' : 'Write the complete sentence...';
          html += `<input type="text" class="answer-input" id="q${qNum}" placeholder="${placeholder}">`;
        }
        
        html += `</div>`;
      }
      
      return html;
    }

    function getPlaceholderContent(lessonNum) {
      const lesson = lessonData[currentLevel][lessonNum];
      const questionStart = lesson.questionRange[0];
      const questionEnd = lesson.questionRange[1];
      
      return `
        <div class="placeholder-content">
          <h3>📚 ${lesson.title}</h3>
          <p>Content for this lesson will be added here.</p>
          <p><strong>Assigned Question Range:</strong> ${questionStart} - ${questionEnd}</p>
        </div>
        
        <div class="add-content-guide">
          <h4>📝 How to Add Content for This Lesson:</h4>
          <p><strong>Just add questions to questionDatabase - everything else is automatic!</strong></p>
          <p>1. Find the <code>questionDatabase</code> object in the script</p>
          <p>2. Add a new lesson entry like this:</p>
          <pre>lesson${lessonNum}: {
  ${questionStart}: { 
    text: "Your question text here", 
    type: "select", 
    options: ["A - Option1", "B - Option2", "C - Option3", "D - Option4"] 
  },
  ${questionStart + 1}: { 
    text: "Another question", 
    type: "input" 
  },
  ${questionStart + 2}: { 
    text: "Arrange in correct order: A 第一部分 B 第二部分 C 第三部分", 
    type: "input" 
  },
  // Add all questions ${questionStart} to ${questionEnd}
}</pre>
          <p>3. That's it! The lesson will automatically:</p>
          <ul style="margin-left: 20px; margin-top: 10px;">
            <li>✅ Show green border on lesson button</li>
            <li>✅ Generate all question HTML automatically</li>
            <li>✅ Handle different question types (select, input, reading passages)</li>
            <li>✅ Enable downloading answers for this lesson</li>
          </ul>
          <p style="margin-top: 15px; color: #28a745; font-weight: bold;">
            No manual functions needed - just add questions and reload the page!
          </p>
        </div>
      `;
    }

    // Enhanced download function that works with any lesson automatically
    function downloadAnswers() {
      const lesson = lessonData[currentLevel][currentLesson];
      const hasContent = hasLessonContent(currentLevel, currentLesson);
      const timestamp = new Date();
      
      let content = `${currentLevel} - ${lesson.title}\n`;
      content += `Completed: ${timestamp.toLocaleDateString()} ${timestamp.toLocaleTimeString()}\n`;
      content += `${'='.repeat(60)}\n\n`;
      
      // Add notes
      const vocabNotes = document.getElementById('vocabulary-notes').value;
      const grammarNotes = document.getElementById('grammar-notes').value;
      
      content += `LESSON NOTES\n`;
      content += `${'-'.repeat(30)}\n`;
      content += `Vocabulary Notes: ${vocabNotes || 'No notes yet'}\n\n`;
      content += `Grammar Notes: ${grammarNotes || 'No notes yet'}\n\n`;
      
      if (!hasContent) {
        content += `LESSON STATUS\n`;
        content += `${'-'.repeat(30)}\n`;
        content += `This lesson does not have content yet.\n`;
        content += `Assigned question range: ${lesson.questionRange[0]} - ${lesson.questionRange[1]}\n\n`;
      } else {
        // Get questions for current lesson automatically
        const lessonKey = `lesson${currentLesson}`;
        const questions = questionDatabase[lessonKey];
        
        if (questions) {
          content += `QUESTIONS AND ANSWERS\n`;
          content += `${'-'.repeat(30)}\n`;
          
          const questionNumbers = Object.keys(questions).map(Number).sort((a, b) => a - b);
          for (let i of questionNumbers) {
            const questionInfo = questions[i];
            if (!questionInfo) continue;
            
            let answer = "No answer yet";
            
            if (questionInfo.type === "select") {
              const select = document.getElementById(`q${i}`);
              if (select && select.value) {
                answer = select.value;
              }
            } else if (questionInfo.type === "input") {
              const input = document.getElementById(`q${i}`);
              if (input && input.value.trim()) {
                answer = input.value.trim();
              }
            }
            
            content += `${i}. ${questionInfo.text}\n`;
            content += `    Answer: ${answer}\n\n`;
          }
        }
      }
      
      // Create and download file
      const blob = new Blob([content], { type: 'text/plain; charset=utf-8' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${currentLevel}_${lesson.title.replace(/[^a-zA-Z0-9]/g, '_')}_${timestamp.toISOString().split('T')[0]}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      // Show success message
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'Downloaded! ✓';
      btn.style.background = '#28a745';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '#ff6b6b';
      }, 2000);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      initializePlatform();
      
      // Set focus styles
      document.querySelectorAll('.answer-input, .answer-select, .note-textarea').forEach(element => {
        element.addEventListener('focus', function() {
          this.style.borderColor = '#ff6b6b';
        });
        
        element.addEventListener('blur', function() {
          this.style.borderColor = '#ddd';
        });
      });
    });
  </script>
</body>
</html>
